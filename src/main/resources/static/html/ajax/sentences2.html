
<title>jqGrid - Ace Admin</title>
<meta charset="utf-8">
<link rel="stylesheet" href="../../assets/css/jquery-ui.min.css" />
<link rel="stylesheet" href="../../assets/css/datepicker.css" />
<link rel="stylesheet" href="../../assets/css/ui.jqgrid.css" />


<style>
.input-answer {
	color : black;
}

.title2 {
	font-size: 20px;
}

.title3 {
	font-size: 20px;
	cursor: pointer;
	color: red;
}
</style>

<!-- ajax layout which only needs content area -->
<div class="page-header">
	<h1>
		句子列表
	</h1>
</div><!-- /.page-header -->

<div class="row">
	<div class="col-xs-12">

		<div class="col-xs-12">
			<div id="articleInfo" class="title2"></div>
			<div id="mySenList" style="font-size: 20px;">
			</div>
			<div id="loading" style="font-size: 20px;display: none;">Loading....</div>
			<button id="loadMoreBtn" style="display: none;"  class="btn btn-info" type="button"  onclick="refreshSenList()">加载更多</button>
		</div>
		
		<table id="grid-table"></table>

		<div id="grid-pager"></div>

		<script type="text/javascript">
			var $path_base = "../..";//in Ace demo this will be used for editurl parameter
		</script>

		<!-- PAGE CONTENT ENDS -->
	</div><!-- /.col -->
</div><!-- /.row -->

<!-- page specific plugin scripts -->
<script type="text/javascript">
	var scripts = [null,"../../assets/js/date-time/bootstrap-datepicker.min.js", null]
	var currPage = 1;
	var rowSize = 10;
	var currMaxRowIndex = 1;
	var allLoadDone = false;
	ace.load_ajax_scripts(scripts, function() {
	  //inline scripts related to this page
		jQuery(function($) { 
			refreshSenList();
			
			$(document).scrollTop(0);
			$(window).scroll(function(){
				  //console.log("$(document).scrollTop():" + $(document).scrollTop() + " $(document).height():" + $(document).height()
				//		   + " $(window).height():" + $(window).height());
				if(allLoadDone) {
					return;
				}
		        if($(document).scrollTop() >= $(document).height() - $(window).height()){
		        	$("#loading").show();
		        	refreshSenList();
		        	$("#loading").hide();
		        }
		      });	
		});
	});
	
	function refreshSenList() {
		var articleId = GetArgsFromHref(window.location.href, "articleId");
		articleId = articleId.replace("#page/sentences2", "");
		$("#articleInfo").html("文章ID: " + articleId);
		if(articleId == "") {
			return;
		}
		console.log("refreshSenList articleId:" + articleId);
		$
				.ajax({
					type : "POST",
					url : "../../getSenList2",
					data : {
						page : currPage,
						rows : rowSize,
						articleId : articleId
					},
					async : false,
					dataType : "json",
					success : function(data) {
						if(currPage >= data.total) {
							$("#loadMoreBtn").attr("disabled", true);							
							$("#loadMoreBtn").hide();
							allLoadDone = true;
						} else {
							currPage++;
						}
						console.log("data.length:" + data.rows.length);
						for (var i = 0; i < data.rows.length; i++) {
							var oneArticleHtml = "<div  style='border: 3px dashed #ccc;margin-top:5px;'   >";
							oneArticleHtml += "<table   class='table table-striped table-bordered table-hover'>";
							oneArticleHtml += "<tr>";
							oneArticleHtml += "	  <td colspan=2>第" + (currMaxRowIndex++) + "句</td>";
							oneArticleHtml += "</tr>";
							oneArticleHtml += "<tr>";
							oneArticleHtml += "	  <td colspan=2>";
							oneArticleHtml += 		data.rows[i].content + "&nbsp;&nbsp;";
							oneArticleHtml += "      <b>收藏 &rarr;</b> <span class='title3'  onclick='toggleForkSen(this, " + data.rows[i].id + ")'> ";
							if(data.rows[i].usefulFlag != 'Yes') {
								oneArticleHtml += "      <i class='ace-icon glyphicon glyphicon-star-empty'></i>";
							} else {
								oneArticleHtml += "      <i class='ace-icon glyphicon glyphicon-star'></i>";
							}
							oneArticleHtml += "      </span>";
							oneArticleHtml += "	  </td>";
							oneArticleHtml += "</tr>";
							oneArticleHtml += "</table>";
							oneArticleHtml += "</div>";
							 
							//alert("oneArticleHtml:" + oneArticleHtml);
							$("#mySenList").append(oneArticleHtml);
						}
					},
					error : function(data) {
						alert("submit result error, please contact administrator");
					}

				});
	}
	
		
</script>
